# Web Components Package Design

## Context

The team wants to publish the standalone collection of native Web Components that currently live in this repository in a way that is compatible with both browser-based consumers (via ES modules) and Node/CommonJS tooling. The package should sit alongside the existing React component package while keeping the delivery footprint small and allowing downstream applications to opt into custom element registration behavior that best fits their bootstrapping model.

## Goals

- Establish the package metadata and directory layout before any implementation work begins.
- Align on the module formats, type distribution, and npm metadata required for dual ESM/CJS publication.
- Document the public API so that both framework and non-framework consumers understand how to load and register the elements.

## Decisions

### Package identity and location

- **npm package name:** `@wavelengthusaf/web-components`
  - Mirrors the existing `@wavelengthusaf/components` namespace while signalling that this package exports Custom Elements rather than React components.
- **Workspace directory:** `apps/web-components`
  - Keeps the new package colocated with the current component package and testbed under the monorepo's `apps/` root, simplifying workspace management.
- **Entry strategy:** Manual exports from `src/index.ts` plus an optional auto-registration helper in `src/register.ts`.
  - `src/index.ts` will explicitly export each element class (e.g., `SampleComponentElement`) and any helper types. This keeps tree-shaking effective and lets consumers register only the elements they need.
  - `src/register.ts` will expose a `registerAll()` side-effect function that iterates over available elements and calls `customElements.define`. Bundlers can reference `@wavelengthusaf/web-components/register` when they prefer automatic registration.

### `package.json` blueprint

The package manifest will include the following key fields:

| Field | Value / Notes |
| --- | --- |
| `name` | `@wavelengthusaf/web-components` |
| `version` | Managed independently (starts at `0.1.0` when first published). |
| `description` | "Custom Elements published by the Wavelength team for framework-agnostic reuse." |
| `author` / `license` | Reuse values from the existing package (`563 EWS - Wavelength`, `MIT`). |
| `type` | `module` (so relative `import` paths resolve as ESM by default). |
| `main` | `./dist/cjs/index.cjs` for CommonJS consumers. |
| `module` | `./dist/esm/index.js` for bundlers using native ESM. |
| `types` | `./dist/types/index.d.ts` (emitted by TypeScript). |
| `exports` | Conditional exports map with entries for `.` (default), `./register`, and `./package.json` to direct importers to the proper format/type files. |
| `files` | `dist/**/*`, `README.md`, `CHANGELOG.md` (keep publish footprint small). |
| `scripts` | `build`, `build:esm`, `build:cjs`, `build:types`, `lint`, `test`, mirroring the existing package but scoped to this workspace. |
| `peerDependencies` | `lit` or other shared runtime libraries if introduced; otherwise keep empty to reduce install surface. |
| `devDependencies` | `tsup`, `typescript`, testing utilities, and any tooling needed for compiling vanilla web components. |

### Build outputs

- **ESM bundle:** `dist/esm/index.js` (tree-shakeable, preserves individual class exports). Built with `tsup` targeting `es2020` so modern bundlers can consume it directly.
- **CJS bundle:** `dist/cjs/index.cjs` (for Node-based build pipelines that still require `require`). Produced via `tsup` with CommonJS format.
- **Type declarations:** `dist/types/**/*.d.ts` generated by `tsc --emitDeclarationOnly`. `tsup`'s `dts` option can pipe the declarations into the ESM folder, while a post-build copy step will place them under `dist/types` to keep the `types` path stable.
- **Helper entry:** `dist/esm/register.js` & `dist/cjs/register.cjs` emitted from `src/register.ts`, referenced in the `exports` map.
- **Asset handling:** No bundled CSS/fonts initially. If a component requires assets, we will mirror the existing package's `dist/styles` pattern and document it in a follow-up update.

### Public API surface

- **Named exports** from `src/index.ts` for each custom element class (e.g., `SampleComponentElement`, `BadgeElement`, etc.). These classes extend `HTMLElement` and let consumers register them manually.
- **Utility exports** like `registerSampleComponent()` when a component needs custom registration logic (for instance, differing tag names). These functions wrap `customElements.define` and enforce one-time registration guards.
- **`registerAll()` helper** from `src/register.ts` that registers every element exposed by the package. Importers can call `import { registerAll } from "@wavelengthusaf/web-components/register"; registerAll();` to eagerly define everything.
- **Type exports** for component-specific attribute interfaces (e.g., `SampleComponentAttributes`) so TypeScript consumers can type-check attribute bags when interacting with elements programmatically.
- **No default export** to keep the surface explicit and avoid bundler ambiguity between formats.

## Open questions / Follow-up items

- Confirm whether any shared base classes or mixins will live in this package or continue to live alongside React components.
- Determine if a CDN-friendly self-registering bundle is necessary for script-tag usage; if so, we can add an additional `dist/standalone` artifact in a future iteration.
- Decide on integration testing strategy (Playwright vs. Web Test Runner) once the elements are implemented.